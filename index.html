<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ดึงโค้ด V2Ray และ VLESS ที่มี SNI = BpB-V.PagEs.dev</title>
    <style>
        /* Reset บางส่วนเพื่อความเข้ากันได้ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            color: #333;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2em;
            color: #4a90e2;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .code-list {
            list-style: none;
            padding: 0;
        }

        .code-item {
            background: #f9f9f9;
            border-left: 4px solid #4a90e2;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            word-break: break-all;
            position: relative;
        }

        .code-item::before {
            content: '';
            position: absolute;
            top: 15px;
            left: -8px;
            width: 16px;
            height: 16px;
            background: #4a90e2;
            border-radius: 50%;
        }

        .loading {
            text-align: center;
            font-size: 1.2em;
            color: #888;
        }

        .error {
            text-align: center;
            color: red;
            font-weight: bold;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            color: #aaa;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            header h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>โค้ด V2Ray และ VLESS ที่มี SNI = BpB-V.PagEs.dev</h1>
    </header>

    <div class="container">
        <div id="loading" class="loading">กำลังโหลดข้อมูล...</div>
        <ul id="codeList" class="code-list"></ul>
        <div id="message" class="error" style="display: none;"></div>
    </div>

    <footer>
        &copy; 2024 เว็บไซต์ดึงโค้ด V2Ray และ VLESS
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urls = [
                "https://raw.githubusercontent.com/barry-far/V2ray-Configs/main/Sub1.txt",
                "https://raw.githubusercontent.com/barry-far/V2ray-Configs/main/Sub2.txt",
                "https://raw.githubusercontent.com/barry-far/V2ray-Configs/main/Sub3.txt",
                "https://raw.githubusercontent.com/barry-far/V2ray-Configs/main/Sub4.txt",
                "https://raw.githubusercontent.com/barry-far/V2ray-Configs/main/Sub5.txt"
            ];

            const sniFilter = 'BpB-V.PagEs.dev';
            const codeListElement = document.getElementById('codeList');
            const loadingElement = document.getElementById('loading');
            const messageElement = document.getElementById('message');

            let filteredCodes = [];

            // ฟังก์ชันดึงข้อมูลจาก URL
            const fetchContent = async (url) => {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return await response.text();
                } catch (error) {
                    console.error(`Error fetching ${url}:`, error);
                    return null;
                }
            };

            // ฟังก์ชันตรวจสอบและกรองโค้ด
            const filterCodes = (line) => {
                line = line.trim();
                if (!line) return;

                // ตรวจสอบว่าเป็น vmess:// หรือ vless://
                if (/^(vmess|vless):\/\/.+$/.test(line)) {
                    if (line.startsWith('vmess://')) {
                        // สำหรับ vmess, ถอดรหัส base64 แล้วตรวจสอบ sni
                        const encoded = line.slice(8);
                        try {
                            const decoded = atob(encoded);
                            const json = JSON.parse(decoded);
                            if (json.sni === sniFilter) {
                                filteredCodes.push(line);
                            }
                        } catch (e) {
                            console.warn('Invalid vmess link:', line);
                        }
                    } else if (line.startsWith('vless://')) {
                        // สำหรับ vless, แยก query parameters และตรวจสอบ sni
                        try {
                            const url = new URL(line);
                            const params = new URLSearchParams(url.search);
                            if (params.get('sni') === sniFilter) {
                                filteredCodes.push(line);
                            }
                        } catch (e) {
                            console.warn('Invalid vless link:', line);
                        }
                    }
                }
            };

            // ฟังก์ชันแสดงผลลัพธ์
            const displayCodes = () => {
                loadingElement.style.display = 'none';
                if (filteredCodes.length > 0) {
                    filteredCodes.forEach(code => {
                        const li = document.createElement('li');
                        li.className = 'code-item';
                        li.textContent = code;
                        codeListElement.appendChild(li);
                    });
                } else {
                    messageElement.textContent = 'ไม่พบโค้ดที่ตรงกับเงื่อนไข';
                    messageElement.style.display = 'block';
                }
            };

            // ฟังก์ชันหลัก
            const init = async () => {
                const fetchPromises = urls.map(url => fetchContent(url));
                const results = await Promise.all(fetchPromises);

                results.forEach(content => {
                    if (content) {
                        const lines = content.split('\n');
                        lines.forEach(line => filterCodes(line));
                    }
                });

                displayCodes();
            };

            init();
        });
    </script>
</body>
</html>
